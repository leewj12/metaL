<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>회원가입</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- jQuery 사용 -->
</head>
<body>
<h2>회원가입</h2>
<form id="signup-form">
  <div>
    <label for="name">이름:</label>
    <input type="text" id="name" name="name" required>
  </div>
  <div>
    <label for="useremail">이메일:</label>
    <input type="email" id="useremail" name="useremail" required>
  </div>
  <div>
    <label for="password">비밀번호:</label>
    <input type="password" id="password" name="password" required>
  </div>
  <div>
    <label for="usergender">성별:</label>
    <select id="usergender" name="usergender">
      <option value="MALE">남성</option>
      <option value="FEMALE">여성</option>
      <option value="OTHER">기타</option>
    </select>
  </div>
  <div>
    <label for="userbirth">생일:</label>
    <input type="date" id="userbirth" name="userbirth" required>
  </div>
  <div>
    <label for="userPhoneNumber">전화번호:</label>
    <input type="text" id="userPhoneNumber" name="userPhoneNumber" required>
  </div>
  <div>
    <label for="userpersonalInfoConsent">개인정보 동의:</label>
    <input type="checkbox" id="userpersonalInfoConsent" name="userpersonalInfoConsent" required>
  </div>
  <div>
    <label for="usermarketingConsent">마케팅 동의:</label>
    <input type="checkbox" id="usermarketingConsent" name="usermarketingConsent" required>
  </div>
  <button type="submit">회원가입</button>
</form>

<script>
  // 회원가입 폼 전송 시 AJAX로 처리
  document.getElementById("signup-form").addEventListener("submit", async function(event) {
      event.preventDefault();  // 기본 폼 제출을 막음

      const formData = {
          name: document.getElementById("name").value,
          useremail: document.getElementById("useremail").value,
          password: document.getElementById("password").value,
          usergender: document.getElementById("usergender").value,
          userbirth: document.getElementById("userbirth").value,
          userPhoneNumber: document.getElementById("userPhoneNumber").value,
          userpersonalInfoConsent: document.getElementById("userpersonalInfoConsent").checked,
          usermarketingConsent: document.getElementById("usermarketingConsent").checked
      };

      try {
          const response = await fetch("/api/signup", {
              method: "POST",
              headers: {
                  "Content-Type": "application/json"
              },
              body: JSON.stringify(formData)
          });

          const data = await response.json();

          // 상태가 "ok"일 경우 성공 메시지 표시
          if (data.status === "ok") {
              alert(data.message);  // "회원가입이 완료되었습니다."
              window.location.href = "/login";  // 로그인 페이지로 리디렉션
          } else {
              alert(data.message || "회원가입에 실패하였습니다. 다시 시도해주세요.");  // 실패 메시지
          }
      } catch (error) {
          console.error("회원가입 오류:", error);
          alert("회원가입 중 오류가 발생했습니다.");
      }
  });
</script>
</body>
</html>
